/**
 * 
 * AnnJS JavaScript Framework
 * version: 0.04
 *
 * Author: Wojciech DÅ‚ubacz (Sahadar)
 * Licensed under GPL Version 2 license
 *
 * Uses jQuery.js
 * Copyright 2012, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 * 
 * Uses LazyLoad.js (https://github.com/rgrove/lazyload/)
 * Copyright (c) 2011 Ryan Grove (ryan@wonko.com). All rights reserved
 * 
 */
var AnnConfig=AnnConfig||{};
(function(j,s,t,g){function v(a,b,c){var e=a[b],d=p(a.namespace+"."+b);a[b]=function(){var b=null;c.apply(this,arguments);b=e.apply(this,arguments);"undefined"!==typeof d.after&&0<d.after.length&&j.each(d.after,function(){var c=d.after.shift();if("undefined"!==typeof c.method){var e=c.method.split("."),f=e.pop();AnnJS.namespace(e.join("."))[f].apply(a,c.args);"function"===typeof c.callback&&c.callback.apply(a,b)}else"function"===typeof c.execute&&c.execute()});return b}}function p(a){for(var a=a.split("."),
b=w,c=[],e=0,e=0;e<a.length;e+=1)c.push(a[e]),"undefined"===typeof b[a[e]]&&(b[a[e]]={},b[a[e]].after=[],b[a[e]].done=!1,b[a[e]].namespace=c.join(".")),b=b[a[e]];return b}"undefined"===typeof console&&(console={log:function(){return!0},error:function(){return!0},info:function(){return!0},warn:function(){return!0},debug:function(){return!0},time:function(){return!0},timeEnd:function(){return!0},groupCollapsed:function(){return!0},groupEnd:function(){return!0},group:function(){return!0}});console.info("Welcome in "+
location.host+", u're now working with AnnJS framework");j(document).ready(function(){console.info("DOM content has loaded, OnDOMready started executing")});AnnConfig=j.extend(!0,{debug:!0,cssAsset:[],jsAsset:[],minifyDir:"",minifyAllowed:!1,tplDir:"/tpl.php?file=",jsDir:"/lib/",cssDir:"/css/",tplTimeStampPrefix:"?",jsTimeStampPrefix:"?",cssTimeStampPrefix:"?",getTemplateMethod:"GET",timeStamp:Math.floor(1E15*Math.random()),tplTimeStamp:Math.floor(1E15*Math.random()),tplSuffix:".tpl",language:null,
fulldebug:!1,hashString:"data-hash"},AnnConfig);var g=j.extend(!0,{},AnnConfig),q={length:0};in_array=function(a,b){for(var c=0,e=b.length;c<e;c++)if(b[c]==a)return!0;return!1};var r={},w={},n={},u={},l={getData:function(a,b){b="undefined"!==typeof b?b:!0;if(a.attr("data-ann")!==t&&a.attr("data-ann")){var c=j.parseJSON(a.attr("data-ann"));b&&a.removeAttr("data-ann");return c}return null},objects:{namespace:function(a){var a="string"===typeof a?a:(console.error("ns_string must be string type"),"randomString"),
a=a.split("."),b=l.objects,c;"objects"===a[0]&&(a=a.slice(1));for(c=0;c<a.length;c+=1)"undefined"===typeof b[a[c]]&&(b[a[c]]={}),b=b[a[c]];b.namespace=a.join(".");return b}},mixins:{},registerMixin:function(a,b){a="string"===typeof a?a:console.error("namespace must be string type");if("object"===typeof this.mixins[a])return console.warn("Mixin with namespace "+a+" is already registered"),!1;l.mixins[a]=b;return!0},whatToLoad:function(a,b,c){var e=AnnJS.minifyOn()?"/"+g.minifyDir+"/b="+a+"&f=":c,b=
b instanceof Array||"string"===typeof b?b:console.error("thingsToLoad must be array or string type"),d=[],k="css"===a?"styles":"js"===a?"scripts":null,h="css"===a?g.cssTimeStampPrefix:"js"===a?g.jsTimeStampPrefix:AnnJS.generateRandomNumber(),m=g.timeStamp;if(null===k)return console.warn('"what" has to be "css" or "js"'),null;if("string"===typeof b&&!in_array(b,AnnJS[k].__loaded))return AnnJS[k].__loaded.push(b),e+b+"."+a+h+m;if(b instanceof Array&&1===b.length&&!in_array(b[0],AnnJS[k].__loaded))return AnnJS[k].__loaded.push(b[0]),
e+b[0]+"."+a+h+m;b instanceof Array&&1<b.length&&j.each(b,function(b,c){in_array(c,AnnJS[k].__loaded)||(AnnJS[k].__loaded.push(c),d.push((!AnnJS.minifyOn()?e:"")+c+"."+a))});if(AnnJS.minifyOn()&&0<d.length)return d=e+d.join(",")+h+m;d instanceof Array&&1===d.length?d[0]+=h+m:d instanceof Array&&j.each(d,function(a){d[a]+=h+m});return d instanceof Array&&0<d.length?d:null},getTemplate:function(a,b){var a="string"===typeof a?a:console.error("templateName must be string type"),c=AnnJS.templates;if("object"!==
typeof n[a]||!(n[a]instanceof Array))n[a]=[];n[a].push("function"===typeof b?b:function(){return!1});"undefined"===typeof c[a]&&(c[a]="loading",j.ajax({type:"GET",dataType:"text",cache:!0,url:window.location.href+g.tplDir+a+g.tplSuffix+g.tplTimeStampPrefix+g.tplTimeStamp,success:function(b){var d=0,k=0;if(""===b)console.error("We're sorry but there is no such template with name "+a);else if("object"===typeof Mustache){c[a]=b;k=n[a].length;for(d=0;d<k;d++)n[a].shift()(c[a])}else delete c[a],console.error("We're sorry but template engine has not occured")}}))},
controller:function(a){for(var a="string"===typeof a?a:console.error("ns_string must be string type"),b=a.split("."),c=[],e=u,d=0,d=0;d<b.length;d+=1)c.push(b[d]),"object"!==typeof e[b[d]]&&(e[b[d]]={controller:null,namespace:c.join("."),innerControllers:{}}),e=d<b.length-1?e[b[d]].innerControllers:e[b[d]].controller;null==e&&(e={});e.namespace=a;e.createdObjects=[];e.rebuildObjectsTable=function(){var a=[];for(dataName in this.createdObjects.all)"object"!==typeof this.createdObjects.all[dataName]||
this.createdObjects.all[dataName].data&&!0===this.createdObjects.all[dataName].data.toRemove?"object"===typeof this.createdObjects.all[dataName]&&this.createdObjects.all[dataName].elements.main.remove():a.push(this.createdObjects.all[dataName]);delete this.createdObjects;this.createdObjects=[];this.createdObjects.all=[];for(rootObjectName in a)if(rootObject=a[rootObjectName],this.createdObjects.push(rootObject),this.createdObjects.all.push(rootObject),rootObject.data)for(dataName in rootObject.data)if(!(dataName instanceof
Array||"object"===typeof dataName))if(this.createdObjects[dataName]||(this.createdObjects[dataName]={}),this.createdObjects[dataName][rootObject.data[dataName]]&&!(this.createdObjects[dataName][rootObject.data[dataName]]instanceof Array)){var b=this.createdObjects[dataName][rootObject.data[dataName]];this.createdObjects[dataName][rootObject.data[dataName]]=[];this.createdObjects[dataName][rootObject.data[dataName]].push(b);this.createdObjects[dataName][rootObject.data[dataName]].push(rootObject)}else this.createdObjects[dataName][rootObject.data[dataName]]&&
this.createdObjects[dataName][rootObject.data[dataName]].length?this.createdObjects[dataName][rootObject.data[dataName]].push(rootObject):this.createdObjects[dataName][rootObject.data[dataName]]=rootObject};e.makeObject=function(b,c){var d=this,f={};"object"===typeof b&&!(b instanceof jQuery)&&(c=b);b instanceof jQuery&&null!==AnnJS.getObject(b)?f=AnnJS.getObject(b):b instanceof jQuery&&(f={elements:{main:b}},b.attr("data-ann")!==t&&j.extend(!0,c,{data:l.getData(b)}));"undefined"!==typeof c&&j.extend(!0,
f,c);if("object"===typeof f.elements){for(element in f.elements)if(f.elements.hasOwnProperty(element))if(selector=f.elements[element],"string"===typeof selector)f.elements[element]=b.find(f.elements[element]);else if("object"===typeof selector&&!(selector instanceof Array)&&"string"===typeof selector.main){if(1===f.elements[selector.main].length){var g=f.elements[selector.main],n=j.extend({},selector);delete n.main;f.elements[element]=AnnJS.callQueries(n,g,f)}}else"object"===typeof selector&&selector instanceof
Array&&"string"===typeof selector[0]&&1===f.elements[selector[0]].length&&(f.elements[element]=AnnJS.callQueries(selector,f.elements[selector[0]],f));j.each(f.elements,function(a){0===f.elements[a].length&&console.warn("There is no element ",a," in ",f," object, from ",d.namespace)})}b instanceof jQuery&&(g=l.objects.namespace(d.namespace),$A.addToHash(g,f));if(f.data)for(dataName in f.data)dataName instanceof Array||"object"===typeof dataName||(d.createdObjects[dataName]||(d.createdObjects[dataName]=
{}),d.createdObjects[dataName][f.data[dataName]]&&!(d.createdObjects[dataName][f.data[dataName]]instanceof Array)?(g=d.createdObjects[dataName][f.data[dataName]],d.createdObjects[dataName][f.data[dataName]]=[],d.createdObjects[dataName][f.data[dataName]].push(g),d.createdObjects[dataName][f.data[dataName]].push(f)):d.createdObjects[dataName][f.data[dataName]]&&d.createdObjects[dataName][f.data[dataName]].length?d.createdObjects[dataName][f.data[dataName]].push(f):d.createdObjects[dataName][f.data[dataName]]=
f);f.root=d;f.createdObjects=[];d.createdObjects.push(f);d.createdObjects.all||(d.createdObjects.all=[]);d.createdObjects.all.push(f);f.makeObject=function(){var a=e.makeObject.apply(f,arguments);a.parentObject=f;return a};f.rebuildObjectsTable=function(){return e.rebuildObjectsTable.apply(f,arguments)};"function"===typeof f.__construct&&(f.__construct(),delete f.__construct);if(f.events)for(a in f.events)g=AnnJS.subscribe(a,f.events[a],f),f.events[a]=g;return f};return e},callQueries:function(a,
b,c){var e=null,d=null,k=e=null,h=!1;for(d in a)if(e=null,!("object"===typeof a&&a instanceof Array&&"object"!==typeof a[d])){"object"===typeof a[d]&&(e=a[d]);if(null!==e){for(k in e)if(e.hasOwnProperty(k)&&"function"!==typeof k)break;d=k;e=e[k]}else if("string"===typeof d)e=a[d];else continue;if(null===e){if(b=0===b[d]().length?(console.warn('Your "'+d+'" function, didn\'t work on "',b,'" element, by ',c),h=!0,j([])):b[d](),!0===h)break}else if("string"===typeof e&&(b=0===b[d](e).length?(console.warn('Your "'+
d+'" function with parameter "'+e+'", didn\'t work on "',b,'" element, by',c),h=!0,j([])):b[d](e),!0===h))break}return b},onDomReady:function(a){var b=null,c=l.controller(a.namespace),e=a.namespace,d=null;j.extend(!0,c,a);!0===g.fulldebug&&console.info("Upgrading methods for "+e+" ...");for(b in c)"function"===typeof c[b]&&v(c,b,function(a){var b=p(e+"."+a);0<b.after.length&&j.each(b.after,function(){var a=b.after.shift();if("undefined"!==typeof a.method){var d=a.method.split("."),e=d.pop();AnnJS.namespace(d.join("."))[e].apply(c,
a.args);"function"===typeof a.callback&&a.callback.apply(c,result)}else"function"===typeof a.execute&&a.execute()});return function(){b.done=!0;!0===g.fulldebug&&(q[q.length]={object:this,method:a,arguments:arguments,number:q.length,type:"method"},q.length++,console.groupCollapsed(this.namespace,", ",a),console.warn("rootFunction: ",a),console.log("object: ",this),console.log("arguments: ",arguments),console.groupEnd())}}(b));delete b;"function"===typeof c.onDomReady&&!0===g.fulldebug&&console.info("Appending domReady for "+
c.namespace);if(c.events)for(d in c.events)a=AnnJS.subscribe(d,c.events[d],c),c.events[d]=a;"function"===typeof c.__construct&&(c.__construct(),delete c.__construct);j(document).ready(function(){function a(){if(c.elements)for(element in c.elements){var b=c.elements[element];if("string"===typeof b)c.elements[element]=j(c.elements[element]);else if("object"===typeof b&&!(b instanceof Array)){if(0<c.elements[b.main].length){var d=c.elements[b.main],h=j.extend({},b);delete h.main;c.elements[element]=
l.callQueries(h,d,c)}}else"object"===typeof b&&b instanceof Array&&"undefined"!==typeof c.elements[b[0]]&&0<c.elements[b[0]].length&&(c.elements[element]=l.callQueries(b,c.elements[b[0]],c));0===c.elements[element].length&&console.warn('There is no element with "'+b+'" selector, executed by "'+e+'" object')}"function"===typeof c.onDomReady&&(!0===g.fulldebug&&console.info("DomReady for "+c.namespace+" started"),c.onDomReady(),!0===g.fulldebug&&console.info("DomReady for "+c.namespace+" ended"))}function b(a){var c=
[];for(referenceName in a)referenceObjectNamespace=a[referenceName],"string"===typeof referenceObjectNamespace&&c.push(referenceObjectNamespace);return 0<c.length?c:null}c.refs?AnnJS.execute({execute:a,relatives:b(c.refs)}):a()});!0===g.fulldebug&&console.info("End of "+e)}};$A=AnnJS={execute:function(a){var b=this,c=null!=a.relatives?a.relatives:null,e=a.args||[],d=a.method,k=a.callback,h=a.execute,g=a=a=null,f=g=null;if("object"===typeof c&&c instanceof Array){if(a=function(){var a=null,f=null;
for(a in c)if("string"===typeof a&&(a=c[a],f=p(a),!1===f.done))return!1;"string"===typeof d?b.execute({method:d,args:e,callback:k}):"function"===typeof h&&h();return!0},f=g=null,!1===a())for(g in c)"string"===typeof g&&(g=c[g],f=p(g),!1===f.done&&f.after.push({execute:a}))}else g=null,a=d.split("."),g=a.pop(),f=a.join("."),null!==b.namespace(f)?(a=b.namespace(f),g=b.namespace(f)[g].apply(a,e),"function"===typeof k&&k.apply(a,[g])):(a=p(d),a.after.push({method:d,args:e,callback:k}))},publish:function(a,
b,c,e){function d(a){j.each(a,function(){this.callback.apply(this.object,b)})}var a="string"===typeof a?a:(console.error("ns_string must be string type"),"randomString"),g=a.split("."),c=c||!1,h,b=b?b:[],m;h=r;for(m=0;m<g.length;m+=1){if("undefined"===typeof h[g[m]])return console.warn("There is no "+a+" subscription"),null;h=h[g[m]];!0===c&&"number"!==typeof e?d(h._events):!0===c&&("number"===typeof e&&m>=g.length-e)&&d(h._events)}!1===c&&d(h._events)},subscribe:function(a,b,c){var a="string"===
typeof a?a:(console.error("ns_string must be string type"),"randomString"),e=a.split("."),d,g=c?!0:!1,c=g?c:b,h=null,h=0,j=arguments;d=r;for(h=0;h<e.length;h+=1){if(g&&"_"===e[h].substring(0,1))return e[h]=c.data[e[h].substring(1,e[h].length)],arguments[0]=e.join("."),AnnJS.subscribe.apply(AnnJS,arguments);if(g&&"+"===e[h].substring(0,1)){d=c.data[e[h].substring(1,e[h].length)];for(var g=a,f=0,l=[],f=0;f<d.length;f++)e[h]=d[f],j[0]=e.join("."),l.push(AnnJS.subscribe.apply(AnnJS,j));j[0]=g;return[g,
l]}if(g&&"{"===e[h].substring(0,1)){d=a;g=0;f=e[h].split(",");l=[];f[0]=f[0].substring(1,f[0].length);f[f.length-1]=f[f.length-1].substring(0,f[f.length-1].length-1);for(g=0;g<f.length;g++)e[h]=f[g],j[0]=e.join("."),l.push(AnnJS.subscribe.apply(AnnJS,j));j[0]=d;return[d,l]}"undefined"===typeof d[e[h]]&&(d[e[h]]={},d[e[h]]._events=[]);d=d[e[h]]}h={callback:b,object:c};d._events.push(h);return[e.join("."),h]},unsubscribe:function(a){var b=a[0],c=b.split("."),e=a[1],d;d=r;for(i=0;i<c.length;i+=1){if("undefined"===
typeof d[c[i]])return console.error("There is no "+b+" subscription"),null;d=d[c[i]]}d&&j.each(d._events,function(a){this==e&&d._events.splice(a,1)})},styles:{__loaded:[],loadStyles:function(a,b,c){a="string"===typeof a||a instanceof Array?a:console.error("styles must be string or array type");c="undefined"!==typeof c?c:g.cssDir;a=l.whatToLoad("css",a,c);null===a?(!0===g.fulldebug&&console.info("There were no css to load"),b&&b()):s.css(a,function(){b&&b()})}},scripts:{__loaded:[],loadScripts:function(a,
b,c){"string"===typeof a||a instanceof Array||console.error("scripts must be string or array type");c="undefined"!==typeof c?c:g.jsDir;a=l.whatToLoad("js",a,c);null===a?(!0===g.fulldebug&&console.info("There were no js to load"),b&&b()):s.js(a,function(){b&&b()})}},templates:{},tpl:function(a,b,c,e){var a="string"===typeof a?a:console.error("templateName must be string type"),b=b instanceof Array||"object"===typeof b?b:console.error("data must be array/JSON type"),c="function"===typeof c?c:console.error("callback must be function type"),
d=this.templates,e=e||window;"string"===typeof d[a]&&"loading"!==d[a]&&"object"===typeof Mustache?c.call(e,j(Mustache.to_html(d[a],b))):l.getTemplate(a,function(a){c.call(e,j(Mustache.to_html(a,b)))})},mixin:function(a,b){a="string"===typeof a?a:console.error("namespace must be string type");if("object"===typeof l.mixins[a])return b=b||{},j.extend(!0,b,l.mixins[a]);console.warn("There's no mixin with "+a+" namespace");return null},namespace:function(a){for(var a="string"===typeof a?a:console.error("Namespace must be string type"),
a=a.split("."),b=u,c=0,c=0;c<a.length;c+=1){if("object"!==typeof b[a[c]])return null;b=c<a.length-1?b[a[c]].innerControllers:b[a[c]].controller}return b},generateRandomNumber:function(){return Math.floor(1E15*Math.random())},appendHashForElement:function(a,b){var c=this.generateRandomNumber();b.attr(g.hashString,a+"."+c);return c},getHash:function(a){return a.attr(g.hashString)},getObject:function(a){var b;if(!a)return null;if("string"===typeof a)b=a;else if("object"===typeof a)if("string"===typeof AnnJS.getHash(a))b=
AnnJS.getHash(a);else return null;a=b.split(".");b=l.objects;var c;"AnnJS"===a[0]&&(a=a.slice(1));for(c=0;c<a.length;c+=1){if("undefined"===typeof b[a[c]])return null;b=b[a[c]]}return b},addToHash:function(a,b){b=b instanceof Object?b:console.error("elementObject must be object type");null===a&&(a=this);var c=AnnJS.appendHashForElement(a.namespace,b.elements.main);a[c]=b;return a},minifyOn:function(){return g.minifyAllowed},registerController:function(a,b){var c="string"===typeof a.namespace?a.namespace:
console.error("namespace must be string type, while running "+c);!0===g.fulldebug&&console.info("Registering controller: "+c);b="object"===typeof b?b:console.error("extenstion must be object type, while running "+c);"object"===typeof a.refs&&null!==a.refs&&(b.refs=a.refs);var e=this.namespace(a.namespace);"object"===typeof e&&null!=e?console.error("Controller with namespace "+c+" is already registered"):(b.namespace=a.namespace,l.onDomReady(b))},registerMixin:function(a,b){var c="string"===typeof a.namespace?
a.namespace:console.error("namespace must be string type, while running "+c);!0===g.fulldebug&&console.info("Registering mixin: "+c);b.namespace=a.namespace;l.registerMixin(a.namespace,b)}};j.extend(AnnJS.scripts.__loaded,g.jsAsset);j.extend(AnnJS.styles.__loaded,g.cssAsset)})(jQuery,LazyLoad,void 0,AnnConfig);