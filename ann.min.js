/**
 * 
 * AnnJS JavaScript Framework
 * version: 0.03
 *
 * Author: Wojciech DÅ‚ubacz (Sahadar)
 * Licensed under GPL Version 2 license
 *
 * Uses jQuery.js
 * Copyright 2012, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 * 
 * Uses LazyLoad.js (https://github.com/rgrove/lazyload/)
 * Copyright (c) 2011 Ryan Grove (ryan@wonko.com). All rights reserved
 * 
 */
var AnnConfig=AnnConfig||{};
(function(h,t,u,g){function w(a,b,d){var e=a[b],c=q(a.namespace+"."+b);a[b]=function(){var b=null;d.apply(this,arguments);b=e.apply(this,arguments);"undefined"!==typeof c.after&&0<c.after.length&&h.each(c.after,function(){var d=c.after.shift();if("undefined"!==typeof d.method){var f=d.method.split("."),k=f.pop();AnnJS.namespace(f.join("."))[k].apply(a,d.args);"function"===typeof d.callback&&d.callback.apply(a,b)}else"function"===typeof d.execute&&d.execute()});return b}}function q(a){for(var a=a.split("."),
b=x,d=[],e=0,e=0;e<a.length;e+=1)d.push(a[e]),"undefined"===typeof b[a[e]]&&(b[a[e]]={},b[a[e]].after=[],b[a[e]].done=!1,b[a[e]].namespace=d.join(".")),b=b[a[e]];return b}"undefined"===typeof console&&(console={log:function(){return!0},error:function(){return!0},info:function(){return!0},warn:function(){return!0},debug:function(){return!0},time:function(){return!0},timeEnd:function(){return!0},groupCollapsed:function(){return!0},groupEnd:function(){return!0},group:function(){return!0}});console.info("Welcome in "+
location.host+", u're now working with AnnJS framework");h(document).ready(function(){console.info("DOM content has loaded, OnDOMready started executing")});AnnConfig=h.extend(!0,{debug:!0,cssAsset:[],jsAsset:[],minifyDir:"",minifyAllowed:!1,tplDir:"/tpl.php?file=",jsDir:"/lib/",cssDir:"/css/",tplTimeStampPrefix:"?",jsTimeStampPrefix:"?",cssTimeStampPrefix:"?",getTemplateMethod:"GET",timeStamp:Math.floor(1E15*Math.random()),tplTimeStamp:Math.floor(1E15*Math.random()),tplSuffix:".tpl",language:null,
fulldebug:!1,hashString:"data-hash"},AnnConfig);var g=h.extend(!0,{},AnnConfig),r={length:0};in_array=function(a,b){for(var d=0,e=b.length;d<e;d++)if(b[d]==a)return!0;return!1};var s={},x={},p={},v={},l={getData:function(a,b){b="undefined"!==typeof b?b:!0;if(a.attr("data-ann")!==u&&a.attr("data-ann")){var d=h.parseJSON(a.attr("data-ann"));b&&a.removeAttr("data-ann");return d}return null},objects:{namespace:function(a){var a="string"===typeof a?a:(console.error("ns_string must be string type"),"randomString"),
a=a.split("."),b=l.objects,d;"objects"===a[0]&&(a=a.slice(1));for(d=0;d<a.length;d+=1)"undefined"===typeof b[a[d]]&&(b[a[d]]={}),b=b[a[d]];b.namespace=a.join(".");return b}},mixins:{},registerMixin:function(a,b){a="string"===typeof a?a:console.error("namespace must be string type");if("object"===typeof this.mixins[a])return console.warn("Mixin with namespace "+a+" is already registered"),!1;l.mixins[a]=b;return!0},whatToLoad:function(a,b,d){var e=AnnJS.minifyOn()?"/"+g.minifyDir+"/b="+a+"&f=":d,b=
b instanceof Array||"string"===typeof b?b:console.error("thingsToLoad must be array or string type"),c=[],j="css"===a?"styles":"js"===a?"scripts":null,m="css"===a?g.cssTimeStampPrefix:"js"===a?g.jsTimeStampPrefix:AnnJS.generateRandomNumber(),f=g.timeStamp;if(null===j)return console.warn('"what" has to be "css" or "js"'),null;if("string"===typeof b&&!in_array(b,AnnJS[j].__loaded))return AnnJS[j].__loaded.push(b),e+b+"."+a+m+f;if(b instanceof Array&&1===b.length&&!in_array(b[0],AnnJS[j].__loaded))return AnnJS[j].__loaded.push(b[0]),
e+b[0]+"."+a+m+f;b instanceof Array&&1<b.length&&h.each(b,function(b,d){in_array(d,AnnJS[j].__loaded)||(AnnJS[j].__loaded.push(d),c.push((!AnnJS.minifyOn()?e:"")+d+"."+a))});if(AnnJS.minifyOn()&&0<c.length)return c=e+c.join(",")+m+f;c instanceof Array&&1===c.length?c[0]+=m+f:c instanceof Array&&h.each(c,function(a){c[a]+=m+f});return c instanceof Array&&0<c.length?c:null},getTemplate:function(a,b){var a="string"===typeof a?a:console.error("templateName must be string type"),d=AnnJS.templates;if("object"!==
typeof p[a]||!(p[a]instanceof Array))p[a]=[];p[a].push("function"===typeof b?b:function(){return!1});"undefined"===typeof d[a]&&(d[a]="loading",h.ajax({type:"GET",dataType:"text",cache:!0,url:window.location.href+g.tplDir+a+g.tplSuffix+g.tplTimeStampPrefix+g.tplTimeStamp,success:function(b){var c=0,j=0;if(""===b)console.error("We're sorry but there is no such template with name "+a);else if("object"===typeof Mustache){d[a]=b;j=p[a].length;for(c=0;c<j;c++)p[a].shift()(d[a])}else delete d[a],console.error("We're sorry but template engine has not occured")}}))},
controller:function(a){for(var a="string"===typeof a?a:console.error("ns_string must be string type"),b=a.split("."),d=[],e=v,c=0,c=0;c<b.length;c+=1)d.push(b[c]),"object"!==typeof e[b[c]]&&(e[b[c]]={controller:null,namespace:d.join("."),innerControllers:{}}),e=c<b.length-1?e[b[c]].innerControllers:e[b[c]].controller;null==e&&(e={});e.namespace=a;e.createdObjects=[];e.rebuildObjectsTable=function(){var a=[];for(dataName in this.createdObjects.all)"object"!==typeof this.createdObjects.all[dataName]||
this.createdObjects.all[dataName].data&&!0===this.createdObjects.all[dataName].data.toRemove?"object"===typeof this.createdObjects.all[dataName]&&this.createdObjects.all[dataName].elements.main.remove():a.push(this.createdObjects.all[dataName]);delete this.createdObjects;this.createdObjects=[];this.createdObjects.all=[];for(rootObjectName in a)if(rootObject=a[rootObjectName],this.createdObjects.push(rootObject),this.createdObjects.all.push(rootObject),rootObject.data)for(dataName in rootObject.data)if(!(dataName instanceof
Array||"object"===typeof dataName))if(this.createdObjects[dataName]||(this.createdObjects[dataName]={}),this.createdObjects[dataName][rootObject.data[dataName]]&&!(this.createdObjects[dataName][rootObject.data[dataName]]instanceof Array)){var b=this.createdObjects[dataName][rootObject.data[dataName]];this.createdObjects[dataName][rootObject.data[dataName]]=[];this.createdObjects[dataName][rootObject.data[dataName]].push(b);this.createdObjects[dataName][rootObject.data[dataName]].push(rootObject)}else this.createdObjects[dataName][rootObject.data[dataName]]&&
this.createdObjects[dataName][rootObject.data[dataName]].length?this.createdObjects[dataName][rootObject.data[dataName]].push(rootObject):this.createdObjects[dataName][rootObject.data[dataName]]=rootObject};e.makeObject=function(b,d){var f=this,c={};"object"===typeof b&&!(b instanceof jQuery)&&(d=b);b instanceof jQuery&&null!==AnnJS.getObject(b)?c=AnnJS.getObject(b):b instanceof jQuery&&(c={elements:{main:b}},b.attr("data-ann")!==u&&h.extend(!0,d,{data:l.getData(b)}));"undefined"!==typeof d&&h.extend(!0,
c,d);if("object"===typeof c.elements){for(element in c.elements)if(c.elements.hasOwnProperty(element))if(selector=c.elements[element],"string"===typeof selector)c.elements[element]=b.find(c.elements[element]);else if("object"===typeof selector&&!(selector instanceof Array)&&"string"===typeof selector.main){if(1===c.elements[selector.main].length){var g=c.elements[selector.main],n=h.extend({},selector);delete n.main;c.elements[element]=AnnJS.callQueries(n,g,c)}}else"object"===typeof selector&&selector instanceof
Array&&"string"===typeof selector[0]&&1===c.elements[selector[0]].length&&(c.elements[element]=AnnJS.callQueries(selector,c.elements[selector[0]],c));h.each(c.elements,function(a){0===c.elements[a].length&&console.warn("There is no element ",a," in ",c," object, from ",f.namespace)})}b instanceof jQuery&&(g=l.objects.namespace(f.namespace),$A.addToHash(g,c));if(c.data)for(dataName in c.data)dataName instanceof Array||"object"===typeof dataName||(f.createdObjects[dataName]||(f.createdObjects[dataName]=
{}),f.createdObjects[dataName][c.data[dataName]]&&!(f.createdObjects[dataName][c.data[dataName]]instanceof Array)?(g=f.createdObjects[dataName][c.data[dataName]],f.createdObjects[dataName][c.data[dataName]]=[],f.createdObjects[dataName][c.data[dataName]].push(g),f.createdObjects[dataName][c.data[dataName]].push(c)):f.createdObjects[dataName][c.data[dataName]]&&f.createdObjects[dataName][c.data[dataName]].length?f.createdObjects[dataName][c.data[dataName]].push(c):f.createdObjects[dataName][c.data[dataName]]=
c);c.root=f;c.createdObjects=[];f.createdObjects.push(c);f.createdObjects.all||(f.createdObjects.all=[]);f.createdObjects.all.push(c);c.makeObject=function(){var a=e.makeObject.apply(c,arguments);a.parentObject=c;return a};c.rebuildObjectsTable=function(){return e.rebuildObjectsTable.apply(c,arguments)};"function"===typeof c.__construct&&(c.__construct(),delete c.__construct);if(c.events)for(a in c.events)g=AnnJS.subscribe(a,c.events[a],c),c.events[a]=g;return c};return e},callQueries:function(a,
b,d){var e=null,c=null,j=e=null,m=!1;for(c in a)if(e=null,!("object"===typeof a&&a instanceof Array&&"object"!==typeof a[c])){"object"===typeof a[c]&&(e=a[c]);if(null!==e){for(j in e)if(e.hasOwnProperty(j)&&"function"!==typeof j)break;c=j;e=e[j]}else if("string"===typeof c)e=a[c];else continue;if(null===e){if(b=0===b[c]().length?(console.warn('Your "'+c+'" function, didn\'t work on "',b,'" element, by ',d),m=!0,h([])):b[c](),!0===m)break}else if("string"===typeof e&&(b=0===b[c](e).length?(console.warn('Your "'+
c+'" function with parameter "'+e+'", didn\'t work on "',b,'" element, by',d),m=!0,h([])):b[c](e),!0===m))break}return b},onDomReady:function(a){var b=null,d=l.controller(a.namespace),e=a.namespace,c=null;h.extend(!0,d,a);!0===g.fulldebug&&console.info("Upgrading methods for "+e+" ...");for(b in d)"function"===typeof d[b]&&w(d,b,function(a){var b=q(e+"."+a);0<b.after.length&&h.each(b.after,function(){var a=b.after.shift();if("undefined"!==typeof a.method){var c=a.method.split("."),e=c.pop();AnnJS.namespace(c.join("."))[e].apply(d,
a.args);"function"===typeof a.callback&&a.callback.apply(d,result)}else"function"===typeof a.execute&&a.execute()});return function(){b.done=!0;!0===g.fulldebug&&(r[r.length]={object:this,method:a,arguments:arguments,number:r.length,type:"method"},r.length++,console.groupCollapsed(this.namespace,", ",a),console.warn("rootFunction: ",a),console.log("object: ",this),console.log("arguments: ",arguments),console.groupEnd())}}(b));delete b;"function"===typeof d.onDomReady&&!0===g.fulldebug&&console.info("Appending domReady for "+
d.namespace);if(d.events)for(c in d.events)a=AnnJS.subscribe(c,d.events[c],d),d.events[c]=a;"function"===typeof d.__construct&&(d.__construct(),delete d.__construct);h(document).ready(function(){function a(){if(d.elements)for(element in d.elements){var b=d.elements[element];if("string"===typeof b)d.elements[element]=h(d.elements[element]);else if("object"===typeof b&&!(b instanceof Array)){if(0<d.elements[b.main].length){var c=d.elements[b.main],j=h.extend({},b);delete j.main;d.elements[element]=
l.callQueries(j,c,d)}}else"object"===typeof b&&b instanceof Array&&"undefined"!==typeof d.elements[b[0]]&&0<d.elements[b[0]].length&&(d.elements[element]=l.callQueries(b,d.elements[b[0]],d));0===d.elements[element].length&&console.warn('There is no element with "'+b+'" selector, executed by "'+e+'" object')}"function"===typeof d.onDomReady&&(!0===g.fulldebug&&console.info("DomReady for "+d.namespace+" started"),d.onDomReady(),!0===g.fulldebug&&console.info("DomReady for "+d.namespace+" ended"))}function b(a){var c=
[];for(referenceName in a)referenceObjectNamespace=a[referenceName],"string"===typeof referenceObjectNamespace&&c.push(referenceObjectNamespace);return 0<c.length?c:null}d.refs?AnnJS.execute({execute:a,relatives:b(d.refs)}):a()});!0===g.fulldebug&&console.info("End of "+e)}};$A=AnnJS={execute:function(a){var b=this,d=null!=a.relatives?a.relatives:null,e=a.args||[],c=a.method,j=a.callback,m=a.execute,f=a=a=null,g=f=null;if("object"===typeof d&&d instanceof Array){if(a=function(){var a=null,f=null;
for(a in d)if("string"===typeof a&&(a=d[a],f=q(a),!1===f.done))return!1;"string"===typeof c?b.execute({method:c,args:e,callback:j}):"function"===typeof m&&m();return!0},g=f=null,!1===a())for(f in d)"string"===typeof f&&(f=d[f],g=q(f),!1===g.done&&g.after.push({execute:a}))}else f=null,a=c.split("."),f=a.pop(),g=a.join("."),null!==b.namespace(g)?(a=b.namespace(g),f=b.namespace(g)[f].apply(a,e),"function"===typeof j&&j.apply(a,[f])):(a=q(c),a.after.push({method:c,args:e,callback:j}))},publish:function(a,
b,d,e){function c(a){h.each(a,function(){this.callback.apply(this.object,b)})}var a="string"===typeof a?a:(console.error("ns_string must be string type"),"randomString"),j=a.split("."),d=d||!1,g,b=b?b:[],f;g=s;for(f=0;f<j.length;f+=1){if("undefined"===typeof g[j[f]])return console.warn("There is no "+a+" subscription"),null;g=g[j[f]];!0===d&&"number"!==typeof e?c(g._events):!0===d&&("number"===typeof e&&f>=j.length-e)&&c(g._events)}!1===d&&c(g._events);g._publishes.push(b)},subscribe:function(a,b,
d,e){var a="string"===typeof a?a:(console.error("ns_string must be string type"),"randomString"),c=a.split("."),g,h=d?!0:!1,d=h?d:b,f=null,k=f=0,l=arguments;g=s;for(f=0;f<c.length;f+=1){if(h&&"_"===c[f].substring(0,1))return c[f]=d.data[c[f].substring(1,c[f].length)],arguments[0]=c.join("."),AnnJS.subscribe.apply(AnnJS,arguments);if(h&&"+"===c[f].substring(0,1)){g=d.data[c[f].substring(1,c[f].length)];for(var h=a,k=0,n=[],k=0;k<g.length;k++)c[f]=g[k],l[0]=c.join("."),n.push(AnnJS.subscribe.apply(AnnJS,
l));l[0]=h;return[h,n]}if(h&&"{"===c[f].substring(0,1)){g=a;h=0;k=c[f].split(",");n=[];k[0]=k[0].substring(1,k[0].length);k[k.length-1]=k[k.length-1].substring(0,k[k.length-1].length-1);for(h=0;h<k.length;h++)c[f]=k[h],l[0]=c.join("."),n.push(AnnJS.subscribe.apply(AnnJS,l));l[0]=g;return[g,n]}"undefined"===typeof g[c[f]]&&(g[c[f]]={},g[c[f]]._events=[],g[c[f]]._publishes=[]);g=g[c[f]];if(!0===e)for(;k<g._publishes.length;)b.apply(d,g._publishes[k]),k++}f={callback:b,object:d};g._events.push(f);return[c.join("."),
f]},unsubscribe:function(a){var b=a[0],d=b.split("."),e=a[1],c;c=s;for(i=0;i<d.length;i+=1){if("undefined"===typeof c[d[i]])return console.error("There is no "+b+" subscription"),null;c=c[d[i]]}c&&h.each(c._events,function(a){this==e&&c._events.splice(a,1)})},styles:{__loaded:[],loadStyles:function(a,b,d){a="string"===typeof a||a instanceof Array?a:console.error("styles must be string or array type");d="undefined"!==typeof d?d:g.cssDir;a=l.whatToLoad("css",a,d);null===a?(!0===g.fulldebug&&console.info("There were no css to load"),
b&&b()):t.css(a,function(){b&&b()})}},scripts:{__loaded:[],loadScripts:function(a,b,d){"string"===typeof a||a instanceof Array||console.error("scripts must be string or array type");d="undefined"!==typeof d?d:g.jsDir;a=l.whatToLoad("js",a,d);null===a?(!0===g.fulldebug&&console.info("There were no js to load"),b&&b()):t.js(a,function(){b&&b()})}},templates:{},tpl:function(a,b,d,e){var a="string"===typeof a?a:console.error("templateName must be string type"),b=b instanceof Array||"object"===typeof b?
b:console.error("data must be array/JSON type"),d="function"===typeof d?d:console.error("callback must be function type"),c=this.templates,e=e||window;"string"===typeof c[a]&&"loading"!==c[a]&&"object"===typeof Mustache?d.call(e,h(Mustache.to_html(c[a],b))):l.getTemplate(a,function(a){d.call(e,h(Mustache.to_html(a,b)))})},mixin:function(a,b){a="string"===typeof a?a:console.error("namespace must be string type");if("object"===typeof l.mixins[a])return b=b||{},h.extend(!0,b,l.mixins[a]);console.warn("There's no mixin with "+
a+" namespace");return null},namespace:function(a){for(var a="string"===typeof a?a:console.error("Namespace must be string type"),a=a.split("."),b=v,d=0,d=0;d<a.length;d+=1){if("object"!==typeof b[a[d]])return null;b=d<a.length-1?b[a[d]].innerControllers:b[a[d]].controller}return b},generateRandomNumber:function(){return Math.floor(1E15*Math.random())},appendHashForElement:function(a,b){var d=this.generateRandomNumber();b.attr(g.hashString,a+"."+d);return d},getHash:function(a){return a.attr(g.hashString)},
getObject:function(a){var b;if(!a)return null;if("string"===typeof a)b=a;else if("object"===typeof a)if("string"===typeof AnnJS.getHash(a))b=AnnJS.getHash(a);else return null;a=b.split(".");b=l.objects;var d;"AnnJS"===a[0]&&(a=a.slice(1));for(d=0;d<a.length;d+=1){if("undefined"===typeof b[a[d]])return null;b=b[a[d]]}return b},addToHash:function(a,b){b=b instanceof Object?b:console.error("elementObject must be object type");null===a&&(a=this);var d=AnnJS.appendHashForElement(a.namespace,b.elements.main);
a[d]=b;return a},minifyOn:function(){return g.minifyAllowed},registerController:function(a,b){var d="string"===typeof a.namespace?a.namespace:console.error("namespace must be string type, while running "+d);!0===g.fulldebug&&console.info("Registering controller: "+d);b="object"===typeof b?b:console.error("extenstion must be object type, while running "+d);"object"===typeof a.refs&&null!==a.refs&&(b.refs=a.refs);var e=this.namespace(a.namespace);"object"===typeof e&&null!=e?console.error("Controller with namespace "+
d+" is already registered"):(b.namespace=a.namespace,l.onDomReady(b))},registerMixin:function(a,b){var d="string"===typeof a.namespace?a.namespace:console.error("namespace must be string type, while running "+d);!0===g.fulldebug&&console.info("Registering mixin: "+d);b.namespace=a.namespace;l.registerMixin(a.namespace,b)}};h.extend(AnnJS.scripts.__loaded,g.jsAsset);h.extend(AnnJS.styles.__loaded,g.cssAsset)})(jQuery,LazyLoad,void 0,AnnConfig);